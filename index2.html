<html lang="ja">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=9">
<meta charset="UTF-8">
<script src="/socket.io/socket.io.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
<script src="design.js"></script>
<script src="click.js"></script>
<script src="audio.js"></script>
<script>
var socket = io.connect('http://0.0.0.0:8000/');
socket.on('resDisply', function (start) {
	bgmusic = new Audio("sound/se01." + extension);
	bgmusic.play();
	stage();
	console.log(socket.socket.sessionid);

	/* ★・・・・・・★・・・・・・★・・・・・・★・・・・・・★・・・・・・
	 // Click action:
	 ★・・・・・・★・・・・・・★・・・・・・★・・・・・・★・・・・・・ */

	$('canvas#Btn01').hover(function () {
		$(this).animate({
			opacity:.5
		}, {
			duration:'fast',
			queue:false,
			easing:'easeInOutBounce'
		})
	}, function () {
		$(this).animate({
			opacity:1
		}, {
			duration:'fast',
			queue:false,
			easing:'easeInOutBounce'
		})
	});
	$('canvas#Btn02').hover(function () {
		$(this).animate({
			opacity:.5
		}, {
			duration:'fast',
			queue:false,
			easing:'easeInOutBounce'
		})
	}, function () {
		$(this).animate({
			opacity:1
		}, {
			duration:'fast',
			queue:false,
			easing:'easeInOutBounce'
		})
	});
	$('canvas#Btn03').hover(function () {
		$(this).animate({
			opacity:.5
		}, {
			duration:'fast',
			queue:false,
			easing:'easeInOutBounce'
		})
	}, function () {
		$(this).animate({
			opacity:1
		}, {
			duration:'fast',
			queue:false,
			easing:'easeInOutBounce'
		})
	});
});


/* ★・・・・・・★・・・・・・★・・・・・・★・・・・・・★・・・・・・
 // Catha SE action:
 ★・・・・・・★・・・・・・★・・・・・・★・・・・・・★・・・・・・ */
socket.on('resSoundEffect1', function (res) {
	console.log(res.effect);
	soundList[res.effect].play();
	soundList[res.effect] = new Audio(soundList[res.effect].src);
});

var extension = (function () {
	var audio = new Audio();
	var ext = "";
	if (audio.canPlayType("audio/ogg") == 'maybe') {
		ext = "ogg";
	}
	else if (audio.canPlayType("audio/mp3") == 'maybe') {
		ext = "mp3";
	}
	else if (audio.canPlayType("audio/wav") == 'maybe') {
		ext = "wav";
	}
	return ext;
})();

var soundList = {
	"se00":new Audio("sound/se01." + extension),
	"se01":new Audio("sound/se02." + extension),
	"se02":new Audio("sound/se03." + extension)
};

var rectangle = [];
rectangle[0] = {horizontal:0, vertical:0, width:156, height:249};
rectangle[1] = {horizontal:0, vertical:0, width:156, height:249};
rectangle[2] = {horizontal:0, vertical:0, width:156, height:503};


//		var rundumRGB = (function(){
//			var red = Math.ceil(Math.random()*255);
//			var green = Math.ceil(Math.random()*255);
//			var blue = Math.ceil(Math.random()*255);
//			return  "rgba("+ red +","+green+","+blue+", 1)";
//		})();

function rundumRGB() {
	var red = Math.ceil(Math.random() * 255);
	var green = Math.ceil(Math.random() * 255);
	var blue = Math.ceil(Math.random() * 255);
	return  "rgba(" + red + "," + green + "," + blue + ", 1)";
}

/* ★・・・・・・★・・・・・・★・・・・・・★・・・・・・★・・・・・・
 // Layout action:
 ★・・・・・・★・・・・・・★・・・・・・★・・・・・・★・・・・・・ */
function stage() {

	var wrapperDiv = document.createElement('div');
	wrapperDiv.id = "wrapper";
	document.body.appendChild(wrapperDiv);

	var sideBoxDiv = document.createElement('div');
	sideBoxDiv.id = "sideBox";
	$("div#wrapper").append(sideBoxDiv);

	var btnArea01Div = document.createElement('div');
	btnArea01Div.id = "btnArea01";
	$("div#wrapper").append(btnArea01Div);

	var btnArea02Div = document.createElement('div');
	btnArea02Div.id = "btnArea02";
	$("div#wrapper").append(btnArea02Div);
	
//	var btnArea01Div = $("div#btn01");
//	var btnArea02Div = $("div#btn02");

	console.log(rundumRGB());

	var canvasBtn01 = document.createElement('canvas');
	canvasBtn01.width = rectangle[0].width;
	canvasBtn01.height = rectangle[0].height;
	canvasBtn01.id = 'Btn01';
	canvasBtn01.addEventListener('click', canvasOnClick, false);
	var contextBtn01 = canvasBtn01.getContext('2d');
	contextBtn01.beginPath();
	contextBtn01.fillStyle = rundumRGB();
	contextBtn01.fillRect(
			rectangle[0].horizontal,
			rectangle[0].vertical,
			rectangle[0].width,
			rectangle[0].height);
	btnArea01Div.append(canvasBtn01);
//			document.body.appendChild(canvasBtn01);

	var canvasBtn02 = document.createElement('canvas');
	canvasBtn02.width = rectangle[1].width;
	canvasBtn02.height = rectangle[1].height;
	canvasBtn02.id = 'Btn02';
	canvasBtn02.addEventListener('click', canvasOnClick, false);
	var contextBtn02 = canvasBtn02.getContext('2d');
	contextBtn02.beginPath();
	contextBtn02.fillStyle = rundumRGB();
	contextBtn02.fillRect(
			rectangle[1].horizontal,
			rectangle[1].vertical,
			rectangle[1].width,
			rectangle[1].height);
	btnArea01Div.append(canvasBtn02);
//			document.body.appendChild(canvasBtn02);
	contextBtn02.save();

	var canvasBtn03 = document.createElement('canvas');
	canvasBtn03.width = rectangle[2].width;
	canvasBtn03.height = rectangle[2].height;
	canvasBtn03.id = 'Btn03';
	canvasBtn03.addEventListener('click', canvasOnClick, false);
	var contextBtn03 = canvasBtn03.getContext('2d');
	contextBtn02.restore();
	contextBtn03.beginPath();
	contextBtn03.fillStyle = rundumRGB();
	contextBtn03.fillRect(
			rectangle[2].horizontal,
			rectangle[2].vertical,
			rectangle[2].width,
			rectangle[2].height);
	btnArea02Div.append(canvasBtn03);
//			document.body.appendChild(canvasBtn03);
	contextBtn03.save();


	function canvasOnClick(e) {
		var cell = getCursorPosition(e);
		if (cell.horizontal > rectangle[0].horizontal + 185 &&
				cell.horizontal < rectangle[0].horizontal + rectangle[0].width + 185 &&
				cell.vertical > rectangle[0].vertical &&
				cell.vertical < rectangle[0].vertical + rectangle[0].height
				) {

			socket.emit('soundEffect1', { my:cell.horizonta});
		}
	}

	function getCursorPosition(e) {
		var x;
		var y;
		if (e.pageX || e.pageY) {
			x = e.pageX;
			y = e.pageY;
		}
		else {
			x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
			y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
		}
		return {horizontal:x, vertical:y};
	}

//			$("body").css({"background-color":"#222"});

}


(function(){
	$("canvas").css({"padding":"0px", "margin":"0px"});
	$("#debug").css({"color":"#ffffff", "float":"left"});
	$("#Btn01").css({"padding":"5px"});
	$("#Btn02").css({"padding":"0 5px 5px 5px"});
	$("#Btn03").css({"padding":"5px 5px 5px 0"});
	$("div#wrapper").css({
		"min-height":$(window).height(),
		"width":$(window).width(),
		"display": "block",
		"margin": "0 auto",
		"background-color": "#111",
		"overflow": "auto",
		"height": "100%"
	});
	$("div#sideBox").css({
		"width": "185px",
		"float":"left",
		"height":"100%",
		"margin-right":"auto",
		"background-color": "#222",
		"border-right": "1px solid rgba(0,0,0,.5)",
		"-webkit-box-shadow": "1px 1px 2px rgba(255,255,255,.1)",
		"-moz-box-shadow": "1px 1px 2px rgba(255,255,255,.1)"
	});
	$("div#btnArea01").css({
		"display": "inline-block",
		"width":"166px",
		"position": "relative",
		"float": "left"
	});
	$("div#btnArea02").css({
		"display": "inline-block",
		"width":"166px",
		"position": "relative",
		"float": "left"
	});
})();



</script>
</head>
<body style="margin:0; padding:0;">
</body>
</html>
